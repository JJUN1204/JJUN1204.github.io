
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>박준호님의 퇴근 게이지</title>
  
  <!-- PWA & Mobile Meta -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4f46e5">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3652/3652191.png">

  <!-- Scripts & CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; background: #f8fafc; -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }
    .glass { background: rgba(255, 255, 255, 0.75); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.4); }
    ::-webkit-scrollbar { display: none; }
    .animate-float { animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.35.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // --- Lucide Icons Bridge ---
    const Icon = ({ name, size = 20, className = "", fill = "none" }) => {
      useEffect(() => { lucide.createIcons(); }, []);
      return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
    };

    // --- Utilities ---
    const calculateProgress = (settings) => {
      const now = new Date();
      const getTodayTime = (timeStr) => {
        const [h, m] = timeStr.split(':').map(Number);
        const d = new Date(); d.setHours(h, m, 0, 0);
        return d.getTime();
      };

      const start = getTodayTime(settings.startTime);
      const end = getTodayTime(settings.endTime);
      const lunchS = getTodayTime(settings.lunchStart);
      const lunchE = getTodayTime(settings.lunchEnd);
      const currentTime = now.getTime();

      const totalWorkDuration = end - start;
      const lunchDuration = lunchE - lunchS;
      const netWorkDuration = totalWorkDuration - lunchDuration;

      let elapsedNet = 0;
      let status = 'working';
      let isLunch = false;

      if (currentTime < start) { elapsedNet = 0; status = 'before'; }
      else if (currentTime > end) { elapsedNet = netWorkDuration; status = 'after'; }
      else {
        if (currentTime >= lunchS && currentTime <= lunchE) {
          elapsedNet = lunchS - start;
          status = 'lunch';
          isLunch = true;
        } else if (currentTime < lunchS) {
          elapsedNet = currentTime - start;
        } else {
          elapsedNet = (currentTime - start) - lunchDuration;
        }
      }

      return {
        percentage: Math.max(0, Math.min(100, (elapsedNet / netWorkDuration) * 100)),
        remainingMs: Math.max(0, end - currentTime),
        status,
        isLunchTime: isLunch
      };
    };

    const formatDuration = (ms) => {
      const s = Math.floor((ms / 1000) % 60);
      const m = Math.floor((ms / (1000 * 60)) % 60);
      const h = Math.floor(ms / (1000 * 60 * 60));
      return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    };

    // --- Main App Component ---
    const App = () => {
      const [settings, setSettings] = useState(() => {
        const saved = localStorage.getItem('work_settings');
        return saved ? JSON.parse(saved) : { startTime: '08:00', endTime: '17:00', lunchStart: '12:00', lunchEnd: '13:00' };
      });
      
      const [progress, setProgress] = useState(() => calculateProgress(settings));
      const [showSettings, setShowSettings] = useState(false);

      useEffect(() => {
        const timer = setInterval(() => setProgress(calculateProgress(settings)), 1000);
        return () => clearInterval(timer);
      }, [settings]);

      const updateSettings = (key, value) => {
        const newSettings = { ...settings, [key]: value };
        setSettings(newSettings);
        localStorage.setItem('work_settings', JSON.stringify(newSettings));
      };

      const getStatusColor = () => {
        if (progress.status === 'after') return 'bg-emerald-500';
        if (progress.status === 'lunch') return 'bg-amber-400';
        if (progress.status === 'before') return 'bg-slate-300';
        return 'bg-indigo-600';
      };

      const getStatusMessage = () => {
        switch(progress.status) {
          case 'before': return '업무 준비 중...';
          case 'lunch': return '맛점하세요! (휴식 중)';
          case 'after': return '고생하셨습니다! 퇴근!';
          default: return '열심히 달리는 중...';
        }
      };

      return (
        <div className="min-h-screen flex flex-col items-center justify-center p-5 bg-gradient-to-br from-slate-50 to-blue-50">
          <div className="w-full max-w-md space-y-6">
            
            {/* Top Bar */}
            <div className="flex justify-between items-center px-2">
              <div className="flex items-center gap-3">
                <div className={`p-2.5 rounded-2xl ${getStatusColor()} text-white shadow-lg`}>
                  <Icon name="zap" size={24} />
                </div>
                <h1 className="text-2xl font-black text-slate-800">퇴근 게이지</h1>
              </div>
              <button onClick={() => setShowSettings(!showSettings)} className="p-3 bg-white rounded-2xl shadow-sm border border-slate-100 text-slate-400">
                <Icon name="settings" />
              </button>
            </div>

            {/* Main Gauge Card */}
            <div className="glass rounded-[3rem] p-10 shadow-2xl shadow-indigo-100/50 relative overflow-hidden border border-white">
              {showSettings && (
                <div className="absolute inset-0 z-20 bg-white/95 p-8 overflow-y-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h2 className="text-2xl font-bold">근무 설정</h2>
                    <button onClick={() => setShowSettings(false)} className="text-indigo-600 font-bold">저장</button>
                  </div>
                  <div className="space-y-6">
                    <div className="grid grid-cols-2 gap-4">
                      <TimeInput label="출근" value={settings.startTime} onChange={v => updateSettings('startTime', v)} />
                      <TimeInput label="퇴근" value={settings.endTime} onChange={v => updateSettings('endTime', v)} />
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                      <TimeInput label="점심 시작" value={settings.lunchStart} onChange={v => updateSettings('lunchStart', v)} />
                      <TimeInput label="점심 종료" value={settings.lunchEnd} onChange={v => updateSettings('lunchEnd', v)} />
                    </div>
                  </div>
                </div>
              )}

              <div className="text-center space-y-8">
                <div>
                  <div className="text-8xl font-black text-slate-900 tracking-tighter tabular-nums">
                    {progress.percentage.toFixed(1)}<span className="text-3xl text-slate-300 ml-1">%</span>
                  </div>
                  <p className="text-slate-500 font-bold mt-3">{getStatusMessage()}</p>
                </div>

                {/* Progress Bar */}
                <div className="h-6 w-full bg-slate-100 rounded-full overflow-hidden p-1.5 shadow-inner">
                  <div className={`h-full rounded-full transition-all duration-1000 ${getStatusColor()}`} style={{ width: `${progress.percentage}%` }} />
                </div>

                {/* Stats */}
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-slate-50/50 p-5 rounded-3xl border border-slate-100">
                    <span className="text-[10px] font-black text-slate-400 uppercase block mb-1">남은 시간</span>
                    <span className="text-xl font-black text-slate-700 font-mono tracking-tight">{formatDuration(progress.remainingMs)}</span>
                  </div>
                  <div className="bg-slate-50/50 p-5 rounded-3xl border border-slate-100">
                    <span className="text-[10px] font-black text-slate-400 uppercase block mb-1">퇴근 예정</span>
                    <span className="text-xl font-black text-slate-700">{settings.endTime}</span>
                  </div>
                </div>
              </div>
            </div>

            {/* Bottom Info */}
            <div className="flex justify-center gap-3">
              <div className="px-5 py-2.5 rounded-full bg-white/60 border border-slate-200 text-[10px] font-black text-slate-500 uppercase tracking-widest shadow-sm">
                {settings.startTime} ~ {settings.endTime}
              </div>
            </div>
          </div>
        </div>
      );
    };

    const TimeInput = ({ label, value, onChange }) => (
      <div className="flex flex-col gap-2">
        <label className="text-[10px] font-black text-slate-400 uppercase ml-1">{label}</label>
        <input type="time" value={value} onChange={e => onChange(e.target.value)} className="p-4 bg-slate-50 border border-slate-100 rounded-2xl font-bold text-lg outline-none focus:ring-2 focus:ring-indigo-500" />
      </div>
    );

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
